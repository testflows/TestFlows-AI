name: ü¶æ OmniParser docker image
run-name: ${{ github.actor }} is buiding OmniParser docker image üöÄ
on:
  workflow_dispatch:
    inputs:
      tag:
        description: "Tag"
        default: latest
        required: false
      omniparser_commit:
        description: "https://github.com/microsoft/OmniParser repo commit"
        default: a14c401
        required: false
      omniparser_weights_commit:
        description: "https://huggingface.co/microsoft/OmniParser model weights commit"
        default: 7f4732c
        required: false
jobs:
   build:
    name: ‚öíÔ∏è Build
    runs-on: [ubuntu-22.04]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Cache OmniParser repo
        uses: actions/cache@v4
        with:
          path: OmniParser/repo
          key: ${{ runner.os }}-omniparser-repo-${{ env.OMNIPARSER_COMMIT }}
          restore-keys: |
            ${{ runner.os }}-omniparser-repo-${{ env.OMNIPARSER_COMMIT }}

      - name: Cache OmniParser model weights
        uses: actions/cache@v4
        with:
          path: OmniParser/weights
          key: ${{ runner.os }}-omniparser-model-weights-${{ env.OMNIPARSER_WEIGHTS_COMMIT }}
          restore-keys: |
            ${{ runner.os }}-omniparser-model-weights-${{ env.OMNIPARSER_WEIGHTS_COMMIT }}
      
      - name: Checkout OmniParser repository
        run: |
          git clone --depth=1 https://github.com/microsoft/OmniParser.git OmniParser/repo
          cd OmniParser/repo
          git fetch --depth=1 origin ${{ env.OMNIPARSER_COMMIT }}
          git checkout ${{ env.OMNIPARSER_COMMIT }}
          cd ..

      - name: Install Hugging Face Hub
        run: |
          pip install huggingface_hub

      - name: Download weights
        run: |
          huggingface-cli download microsoft/OmniParser --revision ${{ env.OMNIPARSER_WEIGHTS_COMMIT }} --local-dir weights

      - name: List directory contents
        run: |
          echo "ls"
          ls
          echo "ls weights"
          ls weights
          echo "ls repo/weights"
          ls repo/weights
          
       
